{"ast":null,"code":"import _classCallCheck from \"/Users/nathan.schroeder/Documents/dev/template/thoughtspot_component/frontend/node_modules/@babel/runtime/helpers/esm/classCallCheck\";\nimport _createClass from \"/Users/nathan.schroeder/Documents/dev/template/thoughtspot_component/frontend/node_modules/@babel/runtime/helpers/esm/createClass\";\nimport _get from \"/Users/nathan.schroeder/Documents/dev/template/thoughtspot_component/frontend/node_modules/@babel/runtime/helpers/esm/get\";\nimport _getPrototypeOf from \"/Users/nathan.schroeder/Documents/dev/template/thoughtspot_component/frontend/node_modules/@babel/runtime/helpers/esm/getPrototypeOf\";\nimport _inherits from \"/Users/nathan.schroeder/Documents/dev/template/thoughtspot_component/frontend/node_modules/@babel/runtime/helpers/esm/inherits\";\nimport _createSuper from \"/Users/nathan.schroeder/Documents/dev/template/thoughtspot_component/frontend/node_modules/@babel/runtime/helpers/esm/createSuper\";\n\n/**\n * Copyright (c) 2022\n *\n * Embed a ThoughtSpot Liveboard or visualization\n * https://developers.thoughtspot.com/docs/?pageid=embed-pinboard\n * https://developers.thoughtspot.com/docs/?pageid=embed-a-viz\n *\n * @summary Liveboard & visualization embed\n * @author Ayon Ghosh <ayon.ghosh@thoughtspot.com>\n */\nimport { ERROR_MESSAGE } from '../errors';\nimport { EmbedEvent, Param } from '../types';\nimport { getFilterQuery, getQueryParamString } from '../utils';\nimport { V1Embed } from './ts-embed';\n/**\n * Embed a ThoughtSpot Liveboard or visualization\n * @Category Liveboards and Charts\n */\n\nexport var LiveboardEmbed = /*#__PURE__*/function (_V1Embed) {\n  _inherits(LiveboardEmbed, _V1Embed);\n\n  var _super = _createSuper(LiveboardEmbed);\n\n  // eslint-disable-next-line no-useless-constructor\n  function LiveboardEmbed(domSelector, viewConfig) {\n    var _this;\n\n    _classCallCheck(this, LiveboardEmbed);\n\n    _this = _super.call(this, domSelector, viewConfig);\n    _this.defaultHeight = 500;\n    /**\n     * Set the iframe height as per the computed height received\n     * from the ThoughtSpot app.\n     * @param data The event payload\n     */\n\n    _this.updateIFrameHeight = function (data) {\n      _this.setIFrameHeight(Math.max(data.data, _this.defaultHeight));\n    };\n\n    _this.embedIframeCenter = function (data, responder) {\n      var obj = _this.getIframeCenter();\n\n      responder({\n        type: EmbedEvent.EmbedIframeCenter,\n        data: obj\n      });\n    };\n\n    _this.setIframeHeightForNonEmbedLiveboard = function (data) {\n      if (!data.data.currentPath.startsWith('/embed/viz/')) {\n        _this.setIFrameHeight(_this.defaultHeight);\n      }\n    };\n\n    return _this;\n  }\n  /**\n   * Construct a map of params to be passed on to the\n   * embedded Liveboard or visualization.\n   */\n\n\n  _createClass(LiveboardEmbed, [{\n    key: \"getEmbedParams\",\n    value: function getEmbedParams() {\n      var params = this.getBaseQueryParams();\n      var _this$viewConfig = this.viewConfig,\n          enableVizTransformations = _this$viewConfig.enableVizTransformations,\n          fullHeight = _this$viewConfig.fullHeight,\n          defaultHeight = _this$viewConfig.defaultHeight,\n          visibleVizs = _this$viewConfig.visibleVizs,\n          _this$viewConfig$live = _this$viewConfig.liveboardV2,\n          liveboardV2 = _this$viewConfig$live === void 0 ? false : _this$viewConfig$live,\n          vizId = _this$viewConfig.vizId,\n          activeTabId = _this$viewConfig.activeTabId;\n      var preventLiveboardFilterRemoval = this.viewConfig.preventLiveboardFilterRemoval || this.viewConfig.preventPinboardFilterRemoval;\n\n      if (fullHeight === true) {\n        params[Param.fullHeight] = true;\n      }\n\n      if (defaultHeight) {\n        this.defaultHeight = defaultHeight;\n      }\n\n      if (enableVizTransformations !== undefined) {\n        params[Param.EnableVizTransformations] = enableVizTransformations.toString();\n      }\n\n      if (preventLiveboardFilterRemoval) {\n        params[Param.preventLiveboardFilterRemoval] = true;\n      }\n\n      if (visibleVizs) {\n        params[Param.visibleVizs] = visibleVizs;\n      }\n\n      params[Param.livedBoardEmbed] = true;\n\n      if (vizId) {\n        params[Param.vizEmbed] = true;\n      }\n\n      params[Param.LiveboardV2Enabled] = liveboardV2;\n      var queryParams = getQueryParamString(params, true);\n      return queryParams;\n    }\n    /**\n     * Construct the URL of the embedded ThoughtSpot Liveboard or visualization\n     * to be loaded within the iframe.\n     * @param liveboardId The GUID of the Liveboard.\n     * @param vizId The optional GUID of a visualization within the Liveboard.\n     * @param runtimeFilters A list of runtime filters to be applied to\n     * the Liveboard or visualization on load.\n     */\n\n  }, {\n    key: \"getIFrameSrc\",\n    value: function getIFrameSrc(liveboardId, vizId, runtimeFilters, activeTabId) {\n      var filterQuery = getFilterQuery(runtimeFilters || []);\n      var queryParams = this.getEmbedParams();\n      var queryString = [filterQuery, queryParams].filter(Boolean).join('&');\n      var url = \"\".concat(this.getV1EmbedBasePath(queryString, true, false, false), \"/viz/\").concat(liveboardId);\n\n      if (activeTabId) {\n        url = \"\".concat(url, \"/tab/\").concat(activeTabId);\n      }\n\n      if (vizId) {\n        url = \"\".concat(url, \"/\").concat(vizId);\n      }\n\n      var tsPostHashParams = this.getThoughtSpotPostUrlParams();\n      url = \"\".concat(url).concat(tsPostHashParams);\n      return url;\n    }\n    /**\n     * Triggers an event to the embedded app\n     * @param messageType The event type\n     * @param data The payload to send with the message\n     */\n\n  }, {\n    key: \"trigger\",\n    value: function trigger(messageType) {\n      var data = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : {};\n      var dataWithVizId = data;\n\n      if (this.viewConfig.vizId) {\n        dataWithVizId.vizId = this.viewConfig.vizId;\n      }\n\n      return _get(_getPrototypeOf(LiveboardEmbed.prototype), \"trigger\", this).call(this, messageType, dataWithVizId);\n    }\n    /**\n     * Render an embedded ThoughtSpot Liveboard or visualization\n     * @param renderOptions An object specifying the Liveboard ID,\n     * visualization ID and the runtime filters.\n     */\n\n  }, {\n    key: \"render\",\n    value: function render() {\n      var _a;\n\n      var _this$viewConfig2 = this.viewConfig,\n          vizId = _this$viewConfig2.vizId,\n          activeTabId = _this$viewConfig2.activeTabId,\n          runtimeFilters = _this$viewConfig2.runtimeFilters;\n      var liveboardId = (_a = this.viewConfig.liveboardId) !== null && _a !== void 0 ? _a : this.viewConfig.pinboardId;\n\n      if (!liveboardId) {\n        this.handleError(ERROR_MESSAGE.LIVEBOARD_VIZ_ID_VALIDATION);\n      }\n\n      if (this.viewConfig.fullHeight === true) {\n        this.on(EmbedEvent.RouteChange, this.setIframeHeightForNonEmbedLiveboard);\n        this.on(EmbedEvent.EmbedHeight, this.updateIFrameHeight);\n        this.on(EmbedEvent.EmbedIframeCenter, this.embedIframeCenter);\n      }\n\n      _get(_getPrototypeOf(LiveboardEmbed.prototype), \"render\", this).call(this);\n\n      var src = this.getIFrameSrc(liveboardId, vizId, runtimeFilters, activeTabId);\n      this.renderV1Embed(src);\n      return this;\n    }\n  }]);\n\n  return LiveboardEmbed;\n}(V1Embed);\n/**\n * @hidden\n */\n\nexport var PinboardEmbed = /*#__PURE__*/function (_LiveboardEmbed) {\n  _inherits(PinboardEmbed, _LiveboardEmbed);\n\n  var _super2 = _createSuper(PinboardEmbed);\n\n  function PinboardEmbed() {\n    _classCallCheck(this, PinboardEmbed);\n\n    return _super2.apply(this, arguments);\n  }\n\n  return _createClass(PinboardEmbed);\n}(LiveboardEmbed);","map":{"version":3,"mappings":"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","names":["ERROR_MESSAGE","EmbedEvent","Param","getFilterQuery","getQueryParamString","V1Embed","LiveboardEmbed","domSelector","viewConfig","data","setIFrameHeight","Math","max","defaultHeight","responder","obj","getIframeCenter","type","EmbedIframeCenter","currentPath","startsWith","params","getBaseQueryParams","enableVizTransformations","fullHeight","visibleVizs","liveboardV2","vizId","activeTabId","preventLiveboardFilterRemoval","preventPinboardFilterRemoval","undefined","EnableVizTransformations","toString","livedBoardEmbed","vizEmbed","LiveboardV2Enabled","queryParams","liveboardId","runtimeFilters","filterQuery","getEmbedParams","queryString","filter","Boolean","join","url","getV1EmbedBasePath","tsPostHashParams","getThoughtSpotPostUrlParams","messageType","dataWithVizId","_a","pinboardId","handleError","LIVEBOARD_VIZ_ID_VALIDATION","on","RouteChange","setIframeHeightForNonEmbedLiveboard","EmbedHeight","updateIFrameHeight","embedIframeCenter","src","getIFrameSrc","renderV1Embed","PinboardEmbed"],"sourceRoot":"","sources":["../../../src/embed/liveboard.ts"],"sourcesContent":[null]},"metadata":{},"sourceType":"module"}