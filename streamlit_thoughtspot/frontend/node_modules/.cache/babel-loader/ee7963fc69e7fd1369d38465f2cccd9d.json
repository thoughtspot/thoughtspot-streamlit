{"ast":null,"code":"import _toConsumableArray from \"/Users/nathan.schroeder/Documents/dev/template/streamlit_thoughtspot/frontend/node_modules/@babel/runtime/helpers/esm/toConsumableArray\";\nimport _classCallCheck from \"/Users/nathan.schroeder/Documents/dev/template/streamlit_thoughtspot/frontend/node_modules/@babel/runtime/helpers/esm/classCallCheck\";\nimport _createClass from \"/Users/nathan.schroeder/Documents/dev/template/streamlit_thoughtspot/frontend/node_modules/@babel/runtime/helpers/esm/createClass\";\nimport _get from \"/Users/nathan.schroeder/Documents/dev/template/streamlit_thoughtspot/frontend/node_modules/@babel/runtime/helpers/esm/get\";\nimport _getPrototypeOf from \"/Users/nathan.schroeder/Documents/dev/template/streamlit_thoughtspot/frontend/node_modules/@babel/runtime/helpers/esm/getPrototypeOf\";\nimport _inherits from \"/Users/nathan.schroeder/Documents/dev/template/streamlit_thoughtspot/frontend/node_modules/@babel/runtime/helpers/esm/inherits\";\nimport _createSuper from \"/Users/nathan.schroeder/Documents/dev/template/streamlit_thoughtspot/frontend/node_modules/@babel/runtime/helpers/esm/createSuper\";\n\n/**\n * Copyright (c) 2022\n *\n * Embed ThoughtSpot search or a saved answer\n *\n * @summary Search embed\n * @author Ayon Ghosh <ayon.ghosh@thoughtspot.com>\n */\nimport { DataSourceVisualMode, Param, Action } from '../types';\nimport { getQueryParamString, checkReleaseVersionInBeta } from '../utils';\nimport { TsEmbed } from './ts-embed';\nimport { ERROR_MESSAGE } from '../errors';\nimport { getAuthPromise, getEmbedConfig } from './base';\nimport { getReleaseVersion } from '../auth';\nexport var HiddenActionItemByDefaultForSearchEmbed = [Action.EditACopy, Action.SaveAsView, Action.UpdateTML, Action.EditTML, Action.AnswerDelete];\n/**\n * Embed ThoughtSpot search\n *\n * @Category Search Embed\n */\n\nexport var SearchEmbed = /*#__PURE__*/function (_TsEmbed) {\n  _inherits(SearchEmbed, _TsEmbed);\n\n  var _super = _createSuper(SearchEmbed);\n\n  function SearchEmbed(domSelector, viewConfig) {\n    var _this;\n\n    _classCallCheck(this, SearchEmbed);\n\n    _this = _super.call(this, domSelector);\n    _this.viewConfig = viewConfig;\n    return _this;\n  }\n  /**\n   * Get the state of the data sources panel that the embedded\n   * ThoughtSpot search will be initialized with.\n   */\n\n\n  _createClass(SearchEmbed, [{\n    key: \"getDataSourceMode\",\n    value: function getDataSourceMode() {\n      var dataSourceMode = DataSourceVisualMode.Expanded;\n\n      if (this.viewConfig.collapseDataSources === true) {\n        dataSourceMode = DataSourceVisualMode.Collapsed;\n      }\n\n      if (this.viewConfig.hideDataSources === true) {\n        dataSourceMode = DataSourceVisualMode.Hidden;\n      }\n\n      return dataSourceMode;\n    }\n    /**\n     * Construct the URL of the embedded ThoughtSpot search to be\n     * loaded in the iframe\n     * @param answerId The GUID of a saved answer\n     * @param dataSources A list of data source GUIDs\n     */\n\n  }, {\n    key: \"getIFrameSrc\",\n    value: function getIFrameSrc(answerId, dataSources) {\n      var _a;\n\n      var _this$viewConfig = this.viewConfig,\n          hideResults = _this$viewConfig.hideResults,\n          expandAllDataSource = _this$viewConfig.expandAllDataSource,\n          enableSearchAssist = _this$viewConfig.enableSearchAssist,\n          forceTable = _this$viewConfig.forceTable,\n          searchOptions = _this$viewConfig.searchOptions;\n      var answerPath = answerId ? \"saved-answer/\".concat(answerId) : 'answer';\n      var queryParams = this.getBaseQueryParams();\n      queryParams[Param.HideActions] = [].concat(_toConsumableArray((_a = queryParams[Param.HideActions]) !== null && _a !== void 0 ? _a : []), HiddenActionItemByDefaultForSearchEmbed);\n\n      if (dataSources && dataSources.length) {\n        queryParams[Param.DataSources] = JSON.stringify(dataSources);\n      }\n\n      if (searchOptions === null || searchOptions === void 0 ? void 0 : searchOptions.searchTokenString) {\n        queryParams[Param.searchTokenString] = encodeURIComponent(searchOptions.searchTokenString);\n\n        if (searchOptions.executeSearch) {\n          queryParams[Param.executeSearch] = true;\n        }\n      }\n\n      if (enableSearchAssist) {\n        queryParams[Param.EnableSearchAssist] = true;\n      }\n\n      if (hideResults) {\n        queryParams[Param.HideResult] = true;\n      }\n\n      if (forceTable) {\n        queryParams[Param.ForceTable] = true;\n      }\n\n      queryParams[Param.DataSourceMode] = this.getDataSourceMode();\n      queryParams[Param.UseLastSelectedDataSource] = false;\n      queryParams[Param.searchEmbed] = true;\n      var query = '';\n      var queryParamsString = getQueryParamString(queryParams, true);\n\n      if (queryParamsString) {\n        query = \"?\".concat(queryParamsString);\n      }\n\n      var tsPostHashParams = this.getThoughtSpotPostUrlParams();\n      return \"\".concat(this.getEmbedBasePath(query), \"/\").concat(answerPath).concat(tsPostHashParams);\n    }\n    /**\n     * Render the embedded ThoughtSpot search\n     */\n\n  }, {\n    key: \"render\",\n    value: function render() {\n      _get(_getPrototypeOf(SearchEmbed.prototype), \"render\", this).call(this);\n\n      var _this$viewConfig2 = this.viewConfig,\n          answerId = _this$viewConfig2.answerId,\n          dataSources = _this$viewConfig2.dataSources;\n      var src = this.getIFrameSrc(answerId, dataSources);\n      this.renderIFrame(src, this.viewConfig.frameParams);\n      getAuthPromise().then(function () {\n        if (checkReleaseVersionInBeta(getReleaseVersion(), getEmbedConfig().suppressSearchEmbedBetaWarning)) {\n          alert(ERROR_MESSAGE.SEARCHEMBED_BETA_WRANING_MESSAGE);\n        }\n      });\n      return this;\n    }\n  }]);\n\n  return SearchEmbed;\n}(TsEmbed);","map":{"version":3,"mappings":"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","names":["DataSourceVisualMode","Param","Action","getQueryParamString","checkReleaseVersionInBeta","TsEmbed","ERROR_MESSAGE","getAuthPromise","getEmbedConfig","getReleaseVersion","HiddenActionItemByDefaultForSearchEmbed","EditACopy","SaveAsView","UpdateTML","EditTML","AnswerDelete","SearchEmbed","domSelector","viewConfig","dataSourceMode","Expanded","collapseDataSources","Collapsed","hideDataSources","Hidden","answerId","dataSources","hideResults","expandAllDataSource","enableSearchAssist","forceTable","searchOptions","answerPath","queryParams","getBaseQueryParams","HideActions","_a","length","DataSources","JSON","stringify","searchTokenString","encodeURIComponent","executeSearch","EnableSearchAssist","HideResult","ForceTable","DataSourceMode","getDataSourceMode","UseLastSelectedDataSource","searchEmbed","query","queryParamsString","tsPostHashParams","getThoughtSpotPostUrlParams","getEmbedBasePath","src","getIFrameSrc","renderIFrame","frameParams","then","suppressSearchEmbedBetaWarning","alert","SEARCHEMBED_BETA_WRANING_MESSAGE"],"sourceRoot":"","sources":["../../../src/embed/search.ts"],"sourcesContent":[null]},"metadata":{},"sourceType":"module"}