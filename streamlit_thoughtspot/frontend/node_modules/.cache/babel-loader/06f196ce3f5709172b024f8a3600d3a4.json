{"ast":null,"code":"/**\n * Copyright (c) 2022\n *\n * Common utility functions for ThoughtSpot Visual Embed SDK\n *\n * @summary Utils\n * @author Ayon Ghosh <ayon.ghosh@thoughtspot.com>\n */\n\n/**\n * Construct a runtime filters query string from the given filters.\n * Refer to the following docs for more details on runtime filter syntax:\n * https://cloud-docs.thoughtspot.com/admin/ts-cloud/apply-runtime-filter.html\n * https://cloud-docs.thoughtspot.com/admin/ts-cloud/runtime-filter-operators.html\n * @param runtimeFilters\n */\nexport var getFilterQuery = function getFilterQuery(runtimeFilters) {\n  if (runtimeFilters && runtimeFilters.length) {\n    var filters = runtimeFilters.map(function (filter, valueIndex) {\n      var index = valueIndex + 1;\n      var filterExpr = [];\n      filterExpr.push(\"col\".concat(index, \"=\").concat(filter.columnName));\n      filterExpr.push(\"op\".concat(index, \"=\").concat(filter.operator));\n      filterExpr.push(filter.values.map(function (value) {\n        return \"val\".concat(index, \"=\").concat(value);\n      }).join('&'));\n      return filterExpr.join('&');\n    });\n    return \"\".concat(filters.join('&'));\n  }\n\n  return null;\n};\n/**\n * Convert a value to a string representation to be sent as a query\n * parameter to the ThoughtSpot app.\n * @param value Any parameter value\n */\n\nvar serializeParam = function serializeParam(value) {\n  // do not serialize primitive types\n  if (typeof value === 'string' || typeof value === 'number' || typeof value === 'boolean') {\n    return value;\n  }\n\n  return JSON.stringify(value);\n};\n/**\n * Convert a value to a string:\n * in case of an array, we convert it to CSV.\n * in case of any other type, we directly return the value.\n * @param value\n */\n\n\nvar paramToString = function paramToString(value) {\n  return Array.isArray(value) ? value.join(',') : value;\n};\n/**\n * Return a query param string composed from the given params object\n * @param queryParams\n */\n\n\nexport var getQueryParamString = function getQueryParamString(queryParams) {\n  var shouldSerializeParamValues = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : false;\n  var qp = [];\n  var params = Object.keys(queryParams);\n  params.forEach(function (key) {\n    var val = queryParams[key];\n\n    if (val !== undefined) {\n      var serializedValue = shouldSerializeParamValues ? serializeParam(val) : paramToString(val);\n      qp.push(\"\".concat(key, \"=\").concat(serializedValue));\n    }\n  });\n\n  if (qp.length) {\n    return qp.join('&');\n  }\n\n  return null;\n};\n/**\n * Get a string representation of a dimension value in CSS\n * If numeric, it is considered in pixels.\n * @param value\n */\n\nexport var getCssDimension = function getCssDimension(value) {\n  if (typeof value === 'number') {\n    return \"\".concat(value, \"px\");\n  }\n\n  return value;\n};\n/**\n * Append a string to a URL's hash fragment\n * @param url A URL\n * @param stringToAppend The string to append to the URL hash\n */\n\nexport var appendToUrlHash = function appendToUrlHash(url, stringToAppend) {\n  var outputUrl = url;\n  var encStringToAppend = encodeURIComponent(stringToAppend);\n\n  if (url.indexOf('#') >= 0) {\n    outputUrl = \"\".concat(outputUrl).concat(encStringToAppend);\n  } else {\n    outputUrl = \"\".concat(outputUrl, \"#\").concat(encStringToAppend);\n  }\n\n  return outputUrl;\n};\nexport function getRedirectUrl(url, stringToAppend) {\n  var path = arguments.length > 2 && arguments[2] !== undefined ? arguments[2] : '';\n  var targetUrl = path ? new URL(path, window.location.origin).href : url;\n  return appendToUrlHash(targetUrl, stringToAppend);\n}\nexport var getEncodedQueryParamsString = function getEncodedQueryParamsString(queryString) {\n  if (!queryString) {\n    return queryString;\n  }\n\n  return btoa(queryString).replace(/\\+/g, '-').replace(/\\//g, '_').replace(/=+$/, '');\n};\nexport var getOffsetTop = function getOffsetTop(element) {\n  var rect = element.getBoundingClientRect();\n  return rect.top + window.scrollY;\n};\nexport var embedEventStatus = {\n  START: 'start',\n  END: 'end'\n};\nexport var setAttributes = function setAttributes(element, attributes) {\n  Object.keys(attributes).forEach(function (key) {\n    element.setAttribute(key, attributes[key].toString());\n  });\n};\n\nvar isCloudRelease = function isCloudRelease(version) {\n  return version.endsWith('.cl');\n};\n/* For Search Embed: ReleaseVersionInBeta */\n\n\nexport var checkReleaseVersionInBeta = function checkReleaseVersionInBeta(releaseVersion, suppressBetaWarning) {\n  if (releaseVersion !== '' && !isCloudRelease(releaseVersion)) {\n    var splittedReleaseVersion = releaseVersion.split('.');\n    var majorVersion = Number(splittedReleaseVersion[0]);\n    var isBetaVersion = majorVersion < 8;\n    return !suppressBetaWarning && isBetaVersion;\n  }\n\n  return false;\n};\nexport var getCustomisations = function getCustomisations(embedConfig) {\n  var customCssUrl = embedConfig.customCssUrl;\n  var customisations = embedConfig.customisations;\n  customisations = customisations || {};\n  customisations.style = customisations.style || {};\n  customisations.style.customCSSUrl = customisations.style.customCSSUrl || customCssUrl;\n  return customisations;\n};","map":{"version":3,"mappings":"AAAA;;;;;;;;;AAgBA;;;;;;;AAOA,OAAO,IAAMA,cAAc,GAAG,SAAjBA,cAAiB,CAACC,cAAD,EAA4C;EACtE,IAAIA,cAAc,IAAIA,cAAc,CAACC,MAArC,EAA6C;IACzC,IAAMC,OAAO,GAAGF,cAAc,CAACG,GAAf,CAAmB,UAACC,MAAD,EAASC,UAAT,EAAuB;MACtD,IAAMC,KAAK,GAAGD,UAAU,GAAG,CAA3B;MACA,IAAME,UAAU,GAAG,EAAnB;MACAA,UAAU,CAACC,IAAX,cAAsBF,KAAtB,cAA+BF,MAAM,CAACK,UAAtC;MACAF,UAAU,CAACC,IAAX,aAAqBF,KAArB,cAA8BF,MAAM,CAACM,QAArC;MACAH,UAAU,CAACC,IAAX,CACIJ,MAAM,CAACO,MAAP,CAAcR,GAAd,CAAkB,UAACS,KAAD;QAAA,oBAAiBN,KAAjB,cAA0BM,KAA1B;MAAA,CAAlB,EAAqDC,IAArD,CAA0D,GAA1D,CADJ;MAIA,OAAON,UAAU,CAACM,IAAX,CAAgB,GAAhB,CAAP;IACH,CAVe,CAAhB;IAYA,iBAAUX,OAAO,CAACW,IAAR,CAAa,GAAb,CAAV;EACH;;EAED,OAAO,IAAP;AACH,CAlBM;AAoBP;;;;;;AAKA,IAAMC,cAAc,GAAG,SAAjBA,cAAiB,CAACF,KAAD,EAAe;EAClC;EACA,IACI,OAAOA,KAAP,KAAiB,QAAjB,IACA,OAAOA,KAAP,KAAiB,QADjB,IAEA,OAAOA,KAAP,KAAiB,SAHrB,EAIE;IACE,OAAOA,KAAP;EACH;;EAED,OAAOG,IAAI,CAACC,SAAL,CAAeJ,KAAf,CAAP;AACH,CAXD;AAaA;;;;;;;;AAMA,IAAMK,aAAa,GAAG,SAAhBA,aAAgB,CAACL,KAAD;EAAA,OAClBM,KAAK,CAACC,OAAN,CAAcP,KAAd,IAAuBA,KAAK,CAACC,IAAN,CAAW,GAAX,CAAvB,GAAyCD,KADvB;AAAA,CAAtB;AAGA;;;;;;AAIA,OAAO,IAAMQ,mBAAmB,GAAG,SAAtBA,mBAAsB,CAC/BC,WAD+B,EAGvB;EAAA,IADRC,0BACQ,uEADqB,KACrB;EACR,IAAMC,EAAE,GAAa,EAArB;EACA,IAAMC,MAAM,GAAGC,MAAM,CAACC,IAAP,CAAYL,WAAZ,CAAf;EACAG,MAAM,CAACG,OAAP,CAAe,UAACC,GAAD,EAAQ;IACnB,IAAMC,GAAG,GAAGR,WAAW,CAACO,GAAD,CAAvB;;IACA,IAAIC,GAAG,KAAKC,SAAZ,EAAuB;MACnB,IAAMC,eAAe,GAAGT,0BAA0B,GAC5CR,cAAc,CAACe,GAAD,CAD8B,GAE5CZ,aAAa,CAACY,GAAD,CAFnB;MAGAN,EAAE,CAACf,IAAH,WAAWoB,GAAX,cAAkBG,eAAlB;IACH;EACJ,CARD;;EAUA,IAAIR,EAAE,CAACtB,MAAP,EAAe;IACX,OAAOsB,EAAE,CAACV,IAAH,CAAQ,GAAR,CAAP;EACH;;EAED,OAAO,IAAP;AACH,CArBM;AAuBP;;;;;;AAKA,OAAO,IAAMmB,eAAe,GAAG,SAAlBA,eAAkB,CAACpB,KAAD,EAAmC;EAC9D,IAAI,OAAOA,KAAP,KAAiB,QAArB,EAA+B;IAC3B,iBAAUA,KAAV;EACH;;EAED,OAAOA,KAAP;AACH,CANM;AAQP;;;;;;AAKA,OAAO,IAAMqB,eAAe,GAAG,SAAlBA,eAAkB,CAACC,GAAD,EAAcC,cAAd,EAAwC;EACnE,IAAIC,SAAS,GAAGF,GAAhB;EACA,IAAMG,iBAAiB,GAAGC,kBAAkB,CAACH,cAAD,CAA5C;;EAEA,IAAID,GAAG,CAACK,OAAJ,CAAY,GAAZ,KAAoB,CAAxB,EAA2B;IACvBH,SAAS,aAAMA,SAAN,SAAkBC,iBAAlB,CAAT;EACH,CAFD,MAEO;IACHD,SAAS,aAAMA,SAAN,cAAmBC,iBAAnB,CAAT;EACH;;EAED,OAAOD,SAAP;AACH,CAXM;AAaP,OAAM,SAAUI,cAAV,CAAyBN,GAAzB,EAAsCC,cAAtC,EAAuE;EAAA,IAATM,IAAS,uEAAF,EAAE;EACzE,IAAMC,SAAS,GAAGD,IAAI,GAAG,IAAIE,GAAJ,CAAQF,IAAR,EAAcG,MAAM,CAACC,QAAP,CAAgBC,MAA9B,EAAsCC,IAAzC,GAAgDb,GAAtE;EACA,OAAOD,eAAe,CAACS,SAAD,EAAYP,cAAZ,CAAtB;AACH;AAED,OAAO,IAAMa,2BAA2B,GAAG,SAA9BA,2BAA8B,CAACC,WAAD,EAAwB;EAC/D,IAAI,CAACA,WAAL,EAAkB;IACd,OAAOA,WAAP;EACH;;EACD,OAAOC,IAAI,CAACD,WAAD,CAAJ,CACFE,OADE,CACM,KADN,EACa,GADb,EAEFA,OAFE,CAEM,KAFN,EAEa,GAFb,EAGFA,OAHE,CAGM,KAHN,EAGa,EAHb,CAAP;AAIH,CARM;AAUP,OAAO,IAAMC,YAAY,GAAG,SAAfA,YAAe,CAACC,OAAD,EAAiB;EACzC,IAAMC,IAAI,GAAGD,OAAO,CAACE,qBAAR,EAAb;EACA,OAAOD,IAAI,CAACE,GAAL,GAAWZ,MAAM,CAACa,OAAzB;AACH,CAHM;AAKP,OAAO,IAAMC,gBAAgB,GAAG;EAC5BC,KAAK,EAAE,OADqB;EAE5BC,GAAG,EAAE;AAFuB,CAAzB;AAKP,OAAO,IAAMC,aAAa,GAAG,SAAhBA,aAAgB,CACzBR,OADyB,EAEzBS,UAFyB,EAGnB;EACNrC,MAAM,CAACC,IAAP,CAAYoC,UAAZ,EAAwBnC,OAAxB,CAAgC,UAACC,GAAD,EAAQ;IACpCyB,OAAO,CAACU,YAAR,CAAqBnC,GAArB,EAA0BkC,UAAU,CAAClC,GAAD,CAAV,CAAgBoC,QAAhB,EAA1B;EACH,CAFD;AAGH,CAPM;;AASP,IAAMC,cAAc,GAAG,SAAjBA,cAAiB,CAACC,OAAD;EAAA,OAAqBA,OAAO,CAACC,QAAR,CAAiB,KAAjB,CAArB;AAAA,CAAvB;AAEA;;;AACA,OAAO,IAAMC,yBAAyB,GAAG,SAA5BA,yBAA4B,CACrCC,cADqC,EAErCC,mBAFqC,EAG5B;EACT,IAAID,cAAc,KAAK,EAAnB,IAAyB,CAACJ,cAAc,CAACI,cAAD,CAA5C,EAA8D;IAC1D,IAAME,sBAAsB,GAAGF,cAAc,CAACG,KAAf,CAAqB,GAArB,CAA/B;IACA,IAAMC,YAAY,GAAGC,MAAM,CAACH,sBAAsB,CAAC,CAAD,CAAvB,CAA3B;IACA,IAAMI,aAAa,GAAGF,YAAY,GAAG,CAArC;IACA,OAAO,CAACH,mBAAD,IAAwBK,aAA/B;EACH;;EACD,OAAO,KAAP;AACH,CAXM;AAaP,OAAO,IAAMC,iBAAiB,GAAG,SAApBA,iBAAoB,CAC7BC,WAD6B,EAEJ;EACzB,IAAQC,YAAR,GAAyBD,WAAzB,CAAQC,YAAR;EACA,IAAMC,cAAN,GAAyBF,WAAzB,CAAME,cAAN;EACAA,cAAc,GAAGA,cAAc,IAAK,EAApC;EACAA,cAAc,CAACC,KAAf,GAAuBD,cAAc,CAACC,KAAf,IAAwB,EAA/C;EACAD,cAAc,CAACC,KAAf,CAAqBC,YAArB,GACIF,cAAc,CAACC,KAAf,CAAqBC,YAArB,IAAqCH,YADzC;EAEA,OAAOC,cAAP;AACH,CAVM","names":["getFilterQuery","runtimeFilters","length","filters","map","filter","valueIndex","index","filterExpr","push","columnName","operator","values","value","join","serializeParam","JSON","stringify","paramToString","Array","isArray","getQueryParamString","queryParams","shouldSerializeParamValues","qp","params","Object","keys","forEach","key","val","undefined","serializedValue","getCssDimension","appendToUrlHash","url","stringToAppend","outputUrl","encStringToAppend","encodeURIComponent","indexOf","getRedirectUrl","path","targetUrl","URL","window","location","origin","href","getEncodedQueryParamsString","queryString","btoa","replace","getOffsetTop","element","rect","getBoundingClientRect","top","scrollY","embedEventStatus","START","END","setAttributes","attributes","setAttribute","toString","isCloudRelease","version","endsWith","checkReleaseVersionInBeta","releaseVersion","suppressBetaWarning","splittedReleaseVersion","split","majorVersion","Number","isBetaVersion","getCustomisations","embedConfig","customCssUrl","customisations","style","customCSSUrl"],"sourceRoot":"","sources":["../../src/utils.ts"],"sourcesContent":[null]},"metadata":{},"sourceType":"module"}